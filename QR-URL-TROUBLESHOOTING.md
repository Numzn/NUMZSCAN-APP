# QR URL Troubleshooting Guide

This guide explains how to ensure every QR code generated by the Offline QR Ticket System includes the correct website URL and how to fix issues if it does not.

## Expected QR Format
- **Default format:** `https://program-pro-1.onrender.com?ticket=YOUR-TICKET-ID`
- Normal phone cameras should open this link automatically.
- The app scanner extracts the ticket ID from the URL for offline validation.

## Quick Fix Checklist
1. **Hard refresh the app**
   - Open Developer Tools (F12) → Application/Storage tab → Clear site data.
   - Or Right-click the refresh button → “Empty Cache and Hard Reload”.
2. **Wait for the service worker to update**
   - Service worker cache version: `offline-qr-v3`.
   - Check console for `[SW] Service worker activated`.
3. **Generate new tickets**
   - Old tickets keep the old QR content.
   - New tickets should log `[QR] Generating QR...` only when debug mode is enabled.

## Verifying the Fix
- **Console Log:** When `DEBUG_LOGGING_ENABLED` (in `script.js`) is true, look for `[QR] Generating QR...` logs.
- **Scan Test:** Use a phone camera on a new QR. The browser must open the expected URL.
- **App Scanner:** Scan the same QR inside the app; it should mark the ticket as used.

## Website Integration
Add this code to `program-pro-1.onrender.com` to read ticket IDs from the URL:
```javascript
const urlParams = new URLSearchParams(window.location.search);
const ticketId = urlParams.get('ticket');

if (ticketId) {
  console.log('Ticket ID:', ticketId);
  // TODO: display ticket details or validate the ticket
}
```

## Dev/Test Utilities
The following HTML pages are for development only. They live in the project root, carry a `DEV-ONLY` banner, and can be deleted before production release.
- `debug-qr-content.html`
- `test-normal-scan.html`
- `simulate-website.html`
- `test-url.html`
- `verify-setup.html`

Use them to:
- Debug QR content (`debug-qr-content.html`).
- Dry-run the normal-camera flow (`test-normal-scan.html`).
- Simulate the program website (`simulate-website.html`).

## Residual Tips
- If problems persist in a specific browser, test in incognito / private mode to bypass cached scripts.
- The QR URL base lives in `script.js` (`TICKET_BASE_URL`). Update it when deploying to a new domain.
- The service worker is registered with a versioned URL via `APP_VERSION`; bump the version when shipping changes that must invalidate caches.

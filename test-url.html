<!DOCTYPE html>
<!-- DEV-ONLY TOOL: QR URL format test -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test QR URL Format</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .test-card {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    h1 {
      color: #333;
      margin-top: 0;
    }
    .url-display {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 5px;
      border-left: 4px solid #007bff;
      margin: 15px 0;
      font-family: monospace;
      word-break: break-all;
    }
    .test-button {
      background: #007bff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
    }
    .test-button:hover {
      background: #0056b3;
    }
    .result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 5px;
    }
    .success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }
    .error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }
    #qrContainer {
      margin: 20px 0;
      text-align: center;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
  <div class="test-card">
    <h1>üß™ QR URL Format Test</h1>
    
    <h3>Configuration:</h3>
    <div class="url-display">
      <strong>Base URL:</strong> https://program-pro-1.onrender.com?ticket=<br>
      <small style="color: #666; margin-top: 5px; display: block;">
        ‚úÖ Now uses query parameter - opens directly on your program page!
      </small>
    </div>
    
    <h3>Test Ticket ID:</h3>
    <input type="text" id="testTicketId" value="LHG-TK01-TEST" style="padding: 10px; width: 100%; font-size: 16px; margin: 10px 0;">
    
    <h3>Generated URL:</h3>
    <div class="url-display" id="generatedUrl">
      https://program-pro-1.onrender.com?ticket=LHG-TK01-TEST
    </div>
    
    <button class="test-button" onclick="updateURL()">üîÑ Update URL</button>
    <button class="test-button" onclick="generateQR()">üì± Generate QR Code</button>
    <button class="test-button" onclick="testURL()">üåê Test URL (Open in Browser)</button>
    <button class="test-button" onclick="testScannerExtraction()">üîç Test Scanner Extraction</button>
    
    <div id="qrContainer"></div>
    
    <div id="result"></div>
  </div>

  <script>
    const TICKET_BASE_URL = "https://program-pro-1.onrender.com?ticket=";
    
    function updateURL() {
      const ticketId = document.getElementById('testTicketId').value;
      const fullUrl = `${TICKET_BASE_URL}${ticketId}`;
      document.getElementById('generatedUrl').textContent = fullUrl;
      document.getElementById('result').innerHTML = '';
    }
    
    function generateQR() {
      const ticketId = document.getElementById('testTicketId').value;
      const fullUrl = `${TICKET_BASE_URL}${ticketId}`;
      
      const container = document.getElementById('qrContainer');
      container.innerHTML = '<h3>QR Code:</h3><div id="qrCode"></div>';
      
      new QRCode(document.getElementById('qrCode'), {
        text: fullUrl,
        width: 200,
        height: 200,
        margin: 2
      });
      
      showResult('success', `‚úÖ QR Code generated with URL: ${fullUrl}<br><br>üì± Scan this QR code with your phone camera to test auto-open!`);
    }
    
    function testURL() {
      const ticketId = document.getElementById('testTicketId').value;
      const fullUrl = `${TICKET_BASE_URL}${ticketId}`;
      
      showResult('success', `üåê Opening URL: ${fullUrl}<br><br>This is what will happen when a normal camera scans the QR code.`);
      
      // Open in new tab
      window.open(fullUrl, '_blank');
    }
    
    function testScannerExtraction() {
      const ticketId = document.getElementById('testTicketId').value;
      const fullUrl = `${TICKET_BASE_URL}${ticketId}`;
      
      // Simulate the scanner extraction logic (matches script.js)
      let extractedId = fullUrl;
      
      if (fullUrl.startsWith("http://") || fullUrl.startsWith("https://")) {
        try {
          const url = new URL(fullUrl);
          // Check for query parameter: ?ticket=ID
          if (url.searchParams.has('ticket')) {
            extractedId = url.searchParams.get('ticket');
          }
          // Check for hash fragment: #ID
          else if (url.hash && url.hash.length > 1) {
            extractedId = url.hash.substring(1);
          }
          // Check for path-based: /t/ID or /ticket/ID
          else if (url.pathname.includes("/t/")) {
            const match = url.pathname.match(/\/t\/([^\/\?&#]+)/);
            extractedId = match ? match[1] : url.pathname.split("/t/")[1]?.split(/[\/\?&#]/)[0];
          }
          else if (url.pathname.includes("/ticket/")) {
            const match = url.pathname.match(/\/ticket\/([^\/\?&#]+)/);
            extractedId = match ? match[1] : url.pathname.split("/ticket/")[1]?.split(/[\/\?&#]/)[0];
          }
          // Fallback: get last path segment
          else {
            const pathParts = url.pathname.split("/").filter(p => p);
            extractedId = pathParts[pathParts.length - 1] || fullUrl;
          }
        } catch (e) {
          // Simple string extraction fallback
          if (fullUrl.includes("?ticket=")) {
            extractedId = fullUrl.split("?ticket=")[1]?.split(/[&#]/)[0];
          }
          else if (fullUrl.includes("#")) {
            extractedId = fullUrl.split("#")[1]?.split(/[?&]/)[0];
          }
          else {
            extractedId = fullUrl.split("/").pop()?.split(/[?#]/)[0] || fullUrl;
          }
        }
      }
      
      if (!extractedId || extractedId.trim() === '') {
        extractedId = fullUrl;
      }
      
      const isValid = extractedId === ticketId;
      
      if (isValid) {
        showResult('success', `‚úÖ Scanner extraction test PASSED!<br><br><strong>Input URL:</strong> ${fullUrl}<br><strong>Extracted ID:</strong> ${extractedId}<br><strong>Expected ID:</strong> ${ticketId}<br><br>‚úÖ The scanner will correctly extract the ticket ID from the URL.`);
      } else {
        showResult('error', `‚ùå Scanner extraction test FAILED!<br><br><strong>Input URL:</strong> ${fullUrl}<br><strong>Extracted ID:</strong> ${extractedId}<br><strong>Expected ID:</strong> ${ticketId}<br><br>‚ùå The extracted ID does not match the expected ticket ID.`);
      }
    }
    
    function showResult(type, message) {
      const resultDiv = document.getElementById('result');
      resultDiv.className = `result ${type}`;
      resultDiv.innerHTML = message;
    }
    
    // Initialize
    updateURL();
  </script>
</body>
</html>
